<div class="seller-reviews-container">
  <!-- Page Header with Back Button -->
  <div class="page-header">
    <button class="btn-back" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Retour
    </button>
    <h1>Avis sur mes produits</h1>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading && reviews.length === 0" class="loading">
    <div class="spinner"></div>
    <p>Chargement des avis...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-message">
    <i class="fas fa-exclamation-circle"></i>
    {{ error }}
  </div>

  <!-- Statistics Dashboard -->
  <div *ngIf="statistics" class="statistics-dashboard">
    <div class="stat-card">
      <div class="stat-icon primary">
        <i class="fas fa-comments"></i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.totalReviews }}</h3>
        <p>Total des avis</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon success">
        <i class="fas fa-star"></i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.averageRating | number:'1.1-1' }}</h3>
        <p>Note moyenne</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon info">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.verifiedReviewsCount }}</h3>
        <p>Achats vérifiés</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon warning">
        <i class="fas fa-box"></i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.productCount }}</h3>
        <p>Produits évalués</p>
      </div>
    </div>
  </div>

  <!-- Rating Distribution -->
  <div *ngIf="statistics" class="rating-distribution-card">
    <h2>Distribution des notes</h2>
    <div class="rating-bars">
      <div *ngFor="let dist of getRatingDistributionArray()" class="rating-bar-item">
        <span class="rating-label">{{ dist.rating }} <i class="fas fa-star"></i></span>
        <div class="bar-container">
          <div class="bar-fill" [style.width.%]="dist.percentage"></div>
        </div>
        <span class="rating-count">{{ dist.count }} ({{ dist.percentage | number:'1.0-0' }}%)</span>
      </div>
    </div>
  </div>

  <!-- Filters and Search Section -->
  <div *ngIf="reviews.length > 0 || selectedRating || searchTerm" class="filters-section">
    <div class="search-bar">
      <i class="fas fa-search"></i>
      <input
        type="text"
        placeholder="Rechercher dans les avis (produit, titre, commentaire)..."
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        class="search-input">
      <button *ngIf="searchTerm" class="clear-search" (click)="searchTerm = ''; onSearchChange()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="filters-toolbar">
      <div class="filter-group">
        <label class="filter-label">Note :</label>
        <div class="rating-filters">
          <button
            class="rating-filter-btn"
            [class.active]="!selectedRating"
            (click)="filterByRating(null)">
            Toutes
          </button>
          <button
            *ngFor="let rating of [5, 4, 3, 2, 1]"
            class="rating-filter-btn"
            [class.active]="selectedRating === rating"
            (click)="filterByRating(rating)">
            {{ rating }} <i class="fas fa-star"></i>
          </button>
        </div>
      </div>

      <div class="filter-group">
        <label class="verified-toggle">
          <input
            type="checkbox"
            [(ngModel)]="showVerifiedOnly"
            (change)="toggleVerifiedOnly()">
          <span>Achats vérifiés uniquement</span>
        </label>
      </div>

      <div class="filter-group">
        <label class="filter-label">Trier par :</label>
        <select [(ngModel)]="sortBy" (change)="changeSortBy()" class="sort-select">
          <option value="newest">Plus récents</option>
          <option value="highest">Mieux notés</option>
          <option value="lowest">Moins bien notés</option>
        </select>
      </div>
    </div>

    <div class="results-info">
      <span class="results-count">
        <i class="fas fa-filter"></i>
        {{ filteredReviews.length }} avis trouvé{{ filteredReviews.length > 1 ? 's' : '' }}
      </span>
      <button
        *ngIf="selectedRating || showVerifiedOnly || searchTerm"
        class="clear-filters"
        (click)="selectedRating = null; showVerifiedOnly = false; searchTerm = ''; applyFilters()">
        <i class="fas fa-times-circle"></i> Réinitialiser les filtres
      </button>
    </div>
  </div>

  <!-- Reviews List -->
  <div class="reviews-section">
    <h2>Tous les avis ({{ filteredReviews.length }})</h2>

    <div *ngIf="filteredReviews.length === 0 && !loading" class="no-reviews">
      <i class="fas fa-comment-slash"></i>
      <p *ngIf="!selectedRating && !showVerifiedOnly && !searchTerm">Aucun avis pour le moment</p>
      <p *ngIf="selectedRating || showVerifiedOnly || searchTerm">Aucun avis ne correspond à vos critères</p>
      <p class="help-text" *ngIf="!selectedRating && !showVerifiedOnly && !searchTerm">Les avis apparaîtront ici lorsque vos clients évalueront vos produits</p>
    </div>

    <div class="reviews-list">
      <div *ngFor="let review of filteredReviews; let i = index" class="review-card">        <!-- Product Section -->
        <div class="product-section" *ngIf="review.product">
          <div class="product-label">
            <i class="fas fa-box"></i> Produit évalué
          </div>
          <div class="product-card" (click)="viewProduct(review.product.id)">
            <img
              *ngIf="review.product.imageUrls && review.product.imageUrls.length > 0"
              [src]="review.product.imageUrls[0]"
              [alt]="review.product.name"
              class="product-image">
            <div class="product-details">
              <h4 class="product-name">{{ review.product.name }}</h4>
              <p class="product-sku">SKU: {{ review.product.skuCode }}</p>
            </div>
          </div>
        </div>

        <div class="review-header">
          <div class="user-info">
            <div class="avatar">{{ review.userName?.charAt(0) || 'A' }}</div>
            <div class="user-details">
              <h4>{{ review.userName || 'Anonyme' }}</h4>
              <div class="stars">
                <i *ngFor="let star of getRatingArray(review.rating)" class="fas fa-star"></i>
                <i *ngFor="let star of getEmptyStars(review.rating)" class="far fa-star"></i>
              </div>
            </div>
          </div>
          <div class="review-meta">
            <span class="verified-badge" *ngIf="review.verified">
              <i class="fas fa-check-circle"></i> Achat vérifié
            </span>
            <span class="review-date">{{ review.createdAt | date:'dd/MM/yyyy' }}</span>
          </div>
        </div>

        <div class="review-content">
          <h3>{{ review.title }}</h3>
          <p>{{ review.comment }}</p>
        </div>
      </div>
    </div>    <!-- Load More Button -->
    <div *ngIf="hasMore && filteredReviews.length > 0" class="load-more-section">
      <button class="btn btn-outline" (click)="loadMore()" [disabled]="loading">
        <span *ngIf="!loading">Charger plus d'avis</span>
        <span *ngIf="loading">
          <i class="fas fa-spinner fa-spin"></i> Chargement...
        </span>
      </button>
    </div>
  </div>
</div>
